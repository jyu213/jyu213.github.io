<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Webpack on å‰ç«¯å¨å¨å®¢</title>
    <link>http://jyu213.github.io/tags/webpack/</link>
    <description>Recent content in Webpack on å‰ç«¯å¨å¨å®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <atom:link href="/tags/webpack/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Rollup å’Œ Webpack ä¹‹ Tree Shaking</title>
      <link>http://jyu213.github.io/blog/1/01/01/rollup-%E5%92%8C-webpack-%E4%B9%8B-tree-shaking/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://jyu213.github.io/blog/1/01/01/rollup-%E5%92%8C-webpack-%E4%B9%8B-tree-shaking/</guid>
      <description>

&lt;p&gt;è¿™ä¸ªè¯é¢˜æœ€æ—©æºäºå’ŒåŒäº‹ä¹‹å‰çš„ä¸€æ¬¡è®¨è®ºã€‚Webpack ä¹Ÿæ”¯æŒ Tree Shaking äº†ï¼ŒåŒæ · Rollup ä¹Ÿæ˜¯ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´å®ç°æ˜¯ä¸€è‡´çš„ä¹ˆï¼Ÿå†™äº†ä¸€åŠï¼Œä¸­é—´æ‹–äº†å‡ ä¸ªæœˆï¼Œç„¶åç¤¾åŒºä¸­åˆæœ‰ä¸¤ç¯‡æ¯”è¾ƒä¸é”™çš„æ–‡ç« ï¼Œç„¶ååˆæ‹–äº†å¥½ä¹…ï¼Œæ‰æ…¢æ…¢è¡¥é½äº†æ–‡ç« ã€‚æ‹–å»¶ç—‡ä¼¤ä¸èµ·å•ŠğŸ˜‚ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ¦‚å¿µ&#34;&gt;æ¦‚å¿µ&lt;/h3&gt;

&lt;p&gt;åœ¨æ­¤ä¹‹å‰å…ˆç®€å•çš„è°ˆè°ˆ Tree Shaking çš„æ¦‚å¿µã€‚æœ€æ—©åº”è¯¥æ˜¯ä» Rollup æ¥çš„å§ï¼Œä¸è¿‡å…¶å®ç®€å•ç†è§£çš„è¯ï¼Œå¯ä»¥å½“æˆæ˜¯ &lt;code&gt;dead code elimination&lt;/code&gt; çš„å¦ä¸€ç§è¯´è¾ï¼Œå°±æ˜¯æŠŠæ— ç”¨ä»£ç å‰”é™¤æ‰ã€‚å®ƒä»¬æœ¬è´¨çš„åŒºåˆ«åœ¨äºï¼ŒTree Shaking æ˜¯å¯¼å…¥æœ‰ç”¨çš„ä»£ç ï¼Œè€Œ &lt;code&gt;dead code elimination&lt;/code&gt; æ˜¯æ’é™¤æ— ç”¨ä»£ç ã€‚æ›´å­¦æœ¯çš„è§£é‡Šå¯ä»¥çœ‹ Rich_Harris çš„&lt;a href=&#34;https://medium.com/@Rich_Harris/tree-shaking-versus-dead-code-elimination-d3765df85c80#.p4izirx8z&#34;&gt;å®˜æ–¹è¯´æ˜&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;rollup&#34;&gt;Rollup&lt;/h3&gt;

&lt;p&gt;Rollup ä½œç”¨äºé¡¶çº§ AST èŠ‚ç‚¹ä¸Šï¼Œä¾èµ–äº ES6 æ¨¡å—çš„é™æ€è§£æã€‚ES6 æ¨¡å—æœ‰ä¸ªç‰¹æ€§å¾ˆå¥½ï¼Œå°±æ˜¯å®Œå…¨çš„é™æ€ç»“æ„ï¼Œè¿™æ ·å¯¼å…¥å’Œå¯¼å‡ºçš„å£°æ˜éƒ½æ”¾åœ¨äº†æ¨¡å—æœ€é¡¶å±‚ï¼Œè€Œä¸”éƒ½æ˜¯éåŠ¨æ€çš„ã€‚æ­£å› è¿™ä¸ªè®¾è®¡çš„å¼ºå¤§ï¼Œæ‰ä½¿ç”¨ Rollup çš„ Tree Shaking å¾—ä»¥å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å…ˆä»ç®€å•çš„ä¾‹å­å¼€å§‹çœ‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// action.js
export const walk = () =&amp;gt; console.log(&#39;jianjian is walking&#39;)
export const run = () =&amp;gt; console.log(&#39;jianjian is running&#39;)

// index.js
import {walk} from &#39;./action.js&#39;
walk()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;action.js&lt;/code&gt; ä¸­å®šä¹‰äº†ä¸¤ä¸ªè¡Œä¸ºå‡½æ•°å¹¶å¯¼å‡ºï¼Œåœ¨ &lt;code&gt;index.js&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code&gt;walk&lt;/code&gt; å‡½æ•°ã€‚Rollup ç¼–è¯‘åçš„ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&#39;use strict&#39;;
const walk = () =&amp;gt; console.log(&#39;jianjian is walking&#39;);
walk();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¾ˆæ˜æ˜¾ï¼Œæœªä½¿ç”¨åˆ°çš„ &lt;code&gt;run&lt;/code&gt; å‡½æ•°åˆ™åœ¨ç¼–è¯‘çš„æ—¶å€™è¢«ç§»é™¤æ‰äº†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæ˜¯ CommonJS å†™æ³•çš„è¯ï¼Œè¿˜éœ€è¦é€šè¿‡ &lt;code&gt;rollup-plugin-commonjs&lt;/code&gt; æ’ä»¶æ¥è½¬æ¢ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å†æ¥çœ‹ä¸€çœ‹å¯¹ç±»çš„å¤„ç†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// action.js 
class action1 {
  talk() {
    console.log(&#39;jianjian is talking&#39;)
  }
  walk() {
    console.log(&#39;jianjian is walking&#39;)
  }
}

class action2 {
  walk() {
    console.log(&#39;jianjian is walking&#39;)
  }
}
export {
    action1,
    action2
}

// index.js 
import {action1, action2} from &#39;./class.js&#39;

let act = new action1()
act.talk()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&#39;use strict&#39;;

class action1 {
  talk() {
    console.log(&#39;jianjian is talking&#39;);
  }
  walk() {
    console.log(&#39;jianjian is walking&#39;);
  }
}

let act = new action1();
act.talk();

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç±» &lt;code&gt;action1&lt;/code&gt; ä¸­å®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°ï¼Œ&lt;code&gt;walk&lt;/code&gt; æœªä½¿ç”¨åˆ°ï¼Œ ä½†æ˜¯å®é™…ç»“æœè¿˜æ˜¯ä¼šè¾“å‡ºçš„ï¼Œè€Œ &lt;code&gt;action2&lt;/code&gt; æœªä½¿ç”¨åˆ°åˆ™ä¸è¾“å‡ºã€‚å¦‚æœæ‰“åŒ…çš„æ—¶å€™åŠ äº† babel å°† class è¯­æ³•è½¬æ¢ä¸º ES5 çš„å®ç°çš„è¯å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œæ¯•ç«Ÿå¯¹åŠ¨æ€è¯­æ³•çš„åˆ†ææœ‰å¯èƒ½å¯¼è‡´æ›´å¤§çš„é—®é¢˜ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚çœ‹&lt;a href=&#34;https://github.com/rollup/rollup/issues/349&#34;&gt;è¯é¢˜è®¨è®º&lt;/a&gt;ã€‚è¿™ä¹Ÿå¯¼è‡´ Tree shaking åœ¨å®é™…çš„ä½¿ç”¨åœºæ™¯ä¸­æ˜¾å¾—æœ‰äº›å°´å°¬ï¼Œæ¯•ç«Ÿç›®å‰èƒ½ä¼˜åŒ–çš„ç©ºé—´ä¸Šæœ‰é™ã€‚&lt;/p&gt;

&lt;p&gt;Rollup çš„ä¸»è¦æ„å»ºæµç¨‹åšäº†å¦‚ä¸‹å‡ æ­¥ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æŸ¥æ‰¾ã€‚æ‰¾åˆ°å¯¹åº” &lt;code&gt;entry&lt;/code&gt; æ¨¡å—çš„æ‰€æœ‰ä¾èµ–é¡¹å¹¶å¯¼å…¥(å¯ä»¥æ˜¯ &lt;code&gt;plugin&lt;/code&gt; å¤„ç†åçš„å†…å®¹ï¼Œä¸Šé¢è®²åˆ°çš„ &lt;code&gt;commonjs&lt;/code&gt; çš„å¤„ç†å°±æ˜¯å¦‚æ­¤)ï¼Œè¿”å›æ¨¡å—åŒ…å« &lt;code&gt;code&lt;/code&gt;, &lt;code&gt;ast&lt;/code&gt;, &lt;code&gt;map&lt;/code&gt; ç­‰çš„ JSON ä¿¡æ¯ã€‚åŒæ—¶å­˜å‚¨ç›¸å…³çš„ä¾èµ– &lt;code&gt;imports&lt;/code&gt;, &lt;code&gt;externals&lt;/code&gt; ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»‘å®šã€‚å°†ç´¢å¼•ä¸ä¹‹ç›¸å…³è”ï¼Œæ¥ç”Ÿæˆå®Œæ•´çš„ä¾èµ–ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;æ ‡è®°ã€‚å¼•ç”¨æ‰€æœ‰éœ€è¦è¢«åŒ…å«çš„ç”³æ˜( Tree Shaking å°±æ˜¯åœ¨è¿™ä¸€æ­¥è¿›è¡Œå¤„ç†)&lt;/li&gt;
&lt;li&gt;æ’åºã€‚ä½¿ç”¨å¢å¼ºçš„æ‹“æ‰‘æ’åºå¯¹æ¨¡å—è¿›è¡Œæ’åºï¼Œè§£å†³è¯¸å¦‚å…¨å±€å‘½åå†²çªç­‰é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è€Œ  Tree Shaking å®é™…é’ˆå¯¹ AST è¿›è¡Œåˆ å‡å¤„ç†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å†…å®¹ï¼Œå…·ä½“å¯ä»¥æŸ¥æ‰¾å¯¹åº” AST è¯­æ³•ã€‚å¦‚æœé”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;classDeclaration&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;conditional express&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ExportDefaultDeclaration&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;FunctionDeclaration&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;isStatement&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;SequenceExpression&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Statement&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;VariableDeclaration&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;VariableDeclarator&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;â€‹&lt;/p&gt;

&lt;p&gt;ä¸å¯¹ä¸Šé¢è¯­æ³•æ ‘æ›¿æ¢åšè¿›ä¸€æ­¥è¯´æ˜äº†ï¼Œä¸»è¦å±•å¼€æ¥ç¯‡å¹…æœ‰ç‚¹é•¿ã€‚&lt;/p&gt;

&lt;h3 id=&#34;webpack&#34;&gt;Webpack&lt;/h3&gt;

&lt;p&gt;å†æ¥çœ‹çœ‹ Webpack çš„ç›¸å…³å¤„ç†ã€‚åŒæ ·çš„å…ˆä»å‡½æ•°å…¥æ‰‹ã€‚å–äº†æ ¸å¿ƒçš„ç¼–è¯‘åçš„æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&amp;quot;use strict&amp;quot;;
Object.defineProperty(__webpack_exports__, &amp;quot;__esModule&amp;quot;, { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__action_js__ = __webpack_require__(2);

Object(__WEBPACK_IMPORTED_MODULE_0__action_js__[&amp;quot;a&amp;quot; /* walk */])()



/***/ }),
/* 2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&amp;quot;use strict&amp;quot;;
const walk = () =&amp;gt; console.log(&#39;walk&#39;)
/* harmony export (immutable) */ __webpack_exports__[&amp;quot;a&amp;quot;] = walk;

const run = () =&amp;gt; console.log(&#39;run&#39;)
/* unused harmony export run */
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;walk&lt;/code&gt; å’Œ &lt;code&gt;run&lt;/code&gt; å‡½æ•°è¿˜åœ¨ï¼ŒåŒºåˆ«åœ¨äº &lt;code&gt;run&lt;/code&gt; å‡½æ•°å¤„æœ‰ &lt;code&gt;unused harmony export run&lt;/code&gt; çš„æ³¨é‡Šï¼Œä»è€Œåœ¨ &lt;code&gt;UglifyjsWebpackPlugin&lt;/code&gt; (åº•å±‚ç”¨çš„æ˜¯ uglify-js) çš„æ—¶å€™åšåˆ é™¤å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;ç±»çš„ç»“æœå¤„ç†ç±»ä¼¼ï¼Œè¿™é‡Œä¸å…·ä½“å±•å¼€äº†ã€‚&lt;/p&gt;

&lt;p&gt;æŠ›é™¤ Webpack æ•´ä¸ªå¤æ‚çš„æ„å»ºè¿‡ç¨‹ï¼Œåœ¨  Tree Shaking  ä¸­ä¸»è¦å¤„ç†çš„ä¸¤æ­¥ï¼Œ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æŠ“å–æ‰€æœ‰æ¨¡å—åˆå¹¶åˆ°ä¸€ä¸ªåŒ…æ–‡ä»¶ä¸­ï¼Œä»»ä½•æœªå¯¼å…¥çš„æ–‡ä»¶éƒ½ä¸ä¼šè¢«å¯¼å‡º&lt;/li&gt;
&lt;li&gt;åœ¨æ‰§è¡Œå‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œç§»é™¤ dead code&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¸ªäººè§‰å¾— Webpack çš„è¿™ä¸ªå¤„ç†æ–¹å¼è¿˜æ˜¯ DCE è€Œä¸è¯¥å®šä¹‰åš  Tree Shakingã€‚ä¸è¿‡ä¹Ÿå°±åå­—è€Œå·²ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;todo&#34;&gt;TODO&lt;/h2&gt;

&lt;p&gt;å¾…ç»­ğŸ˜‚â€¦&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
